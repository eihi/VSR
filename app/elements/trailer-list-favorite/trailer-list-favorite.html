<dom-module id="trailer-list-favorite">
  <style>
    :host {
      display: block;
    }
    h1, p{
      padding:16px;
    }
  </style>
  <template>
    <firebase-collection id="firefav" data="{{favorites}}"
                      location="https://resplendent-inferno-5602.firebaseio.com/favorites/este">
    </firebase-collection>
    <template is="dom-repeat" items="{{favorites}}" as="favorite">
      
      <paper-material elevation="1">
        <paper-toolbar>
          <div class="title">{{favorite.title}}</div>
          <div flex>{{firefav}}</div>
          <paper-icon-button icon="favorite" on-tap="unfavorite">
          </paper-icon-button>
        </paper-toolbar>
        <google-youtube chromeless="true" video-id="{{favorite.source}}" fluid="true"></google-youtube>
        <p class="paper-font-body2">{{favorite.description}}</p>
      </paper-material>
    </template>
  </template>
  <script>
    Polymer({
      is: 'trailer-list-favorite',
      properties: {
        firefav: {
          type: String,
          computed: 'getFavorites()'
        }
      },
      getFavorites: function() {
        return 'foo';
      },
      unfavorite: function(data) {
        var authRef = new Firebase("https://resplendent-inferno-5602.firebaseio.com");
                var authData = authRef.getAuth();
                if (authData) {
                  console.log("User " + authData.uid + " is logged in with " + authData.provider);
                  
                var ref = new Firebase('https://resplendent-inferno-5602.firebaseio.com/favorites/'+authData.uid);
                ref.on("value", function(snapshot) {
                  var fav = snapshot.val();
                  delete fav[data.model.favorite.__firebaseKey__];
                  ref.set(fav);
                }, function (errorObject) {
                  console.log("The delete failed: " + errorObject.code);
                });
              }
      }
    });
  </script>
</dom-module>